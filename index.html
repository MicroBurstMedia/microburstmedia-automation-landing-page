<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Velocity Banking Game - Pro Edition</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  color: white;
  padding: 15px;
  overflow-x: hidden;
}

/* Animated Background */
.bg-particles {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  z-index: 0;
  pointer-events: none;
}

.particle {
  position: absolute;
  width: 3px;
  height: 3px;
  background: rgba(56, 189, 248, 0.5);
  border-radius: 50%;
  animation: float 15s infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0) translateX(0); opacity: 0; }
  10% { opacity: 1; }
  90% { opacity: 1; }
  100% { transform: translateY(-100vh) translateX(50px); opacity: 0; }
}

.container {
  max-width: 1400px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

/* Header with Character */
.game-header {
  background: rgba(2, 6, 23, 0.9);
  backdrop-filter: blur(10px);
  border: 1px solid #334155;
  border-radius: 15px;
  padding: 25px;
  margin-bottom: 20px;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.game-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #38bdf8, #22c55e);
}

h1 {
  color: #38bdf8;
  font-size: 2.2em;
  margin-bottom: 10px;
}

.subtitle {
  color: #94a3b8;
  font-size: 1.1em;
}

/* Character Animation */
.character-container {
  position: relative;
  text-align: center;
  margin: 20px 0;
}

.character {
  font-size: 120px;
  display: inline-block;
  animation: bounce 2s infinite;
  cursor: pointer;
  transition: transform 0.3s;
}

.character:hover {
  transform: scale(1.1);
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-20px); }
}

.character-speech {
  background: rgba(56, 189, 248, 0.2);
  border: 2px solid #38bdf8;
  border-radius: 15px;
  padding: 15px;
  margin-top: 15px;
  position: relative;
  display: none;
  animation: fadeIn 0.5s;
}

.character-speech.show {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Level & Badge System */
.progress-bar {
  background: rgba(15, 23, 42, 0.5);
  border: 1px solid #334155;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 20px;
}

.level-display {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.level-badge {
  background: linear-gradient(135deg, #38bdf8, #22c55e);
  padding: 10px 20px;
  border-radius: 25px;
  font-weight: bold;
  font-size: 1.2em;
}

.xp-bar {
  width: 100%;
  height: 25px;
  background: rgba(51, 65, 85, 0.5);
  border-radius: 15px;
  overflow: hidden;
  position: relative;
}

.xp-fill {
  height: 100%;
  background: linear-gradient(90deg, #22c55e, #38bdf8);
  transition: width 0.5s;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
}

.badges-earned {
  display: flex;
  gap: 10px;
  margin-top: 15px;
  flex-wrap: wrap;
}

.badge {
  background: rgba(56, 189, 248, 0.2);
  border: 2px solid #38bdf8;
  padding: 8px 15px;
  border-radius: 20px;
  font-size: 0.9em;
  display: flex;
  align-items: center;
  gap: 5px;
  animation: badgeEarn 0.5s;
}

@keyframes badgeEarn {
  0% { transform: scale(0) rotate(0deg); }
  50% { transform: scale(1.2) rotate(180deg); }
  100% { transform: scale(1) rotate(360deg); }
}

/* Grid Layout */
.game-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  margin-bottom: 20px;
}

.panel {
  background: rgba(2, 6, 23, 0.9);
  backdrop-filter: blur(10px);
  border: 1px solid #334155;
  border-radius: 12px;
  padding: 20px;
  transition: transform 0.3s, border-color 0.3s;
}

.panel:hover {
  transform: translateY(-5px);
  border-color: #38bdf8;
}

.panel h2 {
  color: #38bdf8;
  margin-bottom: 15px;
  font-size: 1.4em;
  display: flex;
  align-items: center;
  gap: 10px;
}

/* Form Elements */
label {
  display: block;
  margin: 10px 0 5px 0;
  color: #94a3b8;
  font-weight: 600;
}

input, select {
  width: 100%;
  padding: 12px;
  background: rgba(15, 23, 42, 0.5);
  border: 2px solid #334155;
  border-radius: 8px;
  color: white;
  font-size: 1em;
  transition: border-color 0.3s;
}

input:focus, select:focus {
  outline: none;
  border-color: #38bdf8;
}

button {
  width: 100%;
  padding: 12px 20px;
  background: linear-gradient(135deg, #38bdf8, #22c55e);
  border: none;
  border-radius: 8px;
  color: white;
  font-weight: bold;
  cursor: pointer;
  margin-top: 10px;
  transition: all 0.3s;
  font-size: 1em;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 20px rgba(56, 189, 248, 0.4);
}

button.secondary {
  background: rgba(51, 65, 85, 0.5);
}

button.danger {
  background: linear-gradient(135deg, #ef4444, #dc2626);
}

/* Sound Toggle */
.sound-toggle {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 100;
  background: rgba(2, 6, 23, 0.9);
  border: 2px solid #38bdf8;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8em;
  cursor: pointer;
  transition: all 0.3s;
}

.sound-toggle:hover {
  transform: scale(1.1);
  box-shadow: 0 5px 20px rgba(56, 189, 248, 0.5);
}

/* Results Display */
.results {
  background: rgba(15, 23, 42, 0.5);
  padding: 20px;
  border-radius: 10px;
  margin-top: 15px;
}

.stat-row {
  display: flex;
  justify-content: space-between;
  padding: 10px 0;
  border-bottom: 1px solid #334155;
}

.stat-row:last-child {
  border-bottom: none;
}

.good { color: #22c55e; }
.warn { color: #facc15; }
.bad { color: #ef4444; }

/* AI Mentor Chat */
.chat {
  background: rgba(15, 23, 42, 0.5);
  border: 1px solid #334155;
  padding: 15px;
  height: 200px;
  overflow-y: auto;
  margin-bottom: 10px;
  border-radius: 8px;
}

.chat p {
  margin: 8px 0;
  padding: 10px;
  background: rgba(56, 189, 248, 0.1);
  border-left: 3px solid #38bdf8;
  border-radius: 5px;
  animation: slideIn 0.3s;
}

@keyframes slideIn {
  from { opacity: 0; transform: translateX(-20px); }
  to { opacity: 1; transform: translateX(0); }
}

/* Strategy Comparison */
.strategy-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
  margin-top: 15px;
}

.strategy-card {
  background: rgba(15, 23, 42, 0.5);
  border: 2px solid #334155;
  padding: 15px;
  border-radius: 10px;
  text-align: center;
  transition: all 0.3s;
}

.strategy-card:hover {
  border-color: #38bdf8;
  transform: scale(1.05);
}

.strategy-card.active {
  border-color: #22c55e;
  background: rgba(34, 197, 94, 0.1);
}

/* Multiplayer Dashboard */
.leaderboard {
  background: rgba(15, 23, 42, 0.5);
  border-radius: 10px;
  padding: 15px;
  max-height: 300px;
  overflow-y: auto;
}

.player-entry {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  margin-bottom: 8px;
  background: rgba(2, 6, 23, 0.5);
  border-radius: 8px;
  border-left: 3px solid #38bdf8;
}

.player-rank {
  font-size: 1.5em;
  font-weight: bold;
  color: #38bdf8;
  min-width: 40px;
}

/* Stripe Checkout Demo */
.checkout-panel {
  background: linear-gradient(135deg, rgba(56, 189, 248, 0.1), rgba(34, 197, 94, 0.1));
  border: 2px solid #38bdf8;
  padding: 25px;
  border-radius: 15px;
}

.price-tag {
  font-size: 3em;
  font-weight: bold;
  text-align: center;
  margin: 20px 0;
  background: linear-gradient(135deg, #38bdf8, #22c55e);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.features-list {
  margin: 20px 0;
}

.feature-item {
  padding: 10px;
  margin: 8px 0;
  background: rgba(2, 6, 23, 0.5);
  border-left: 3px solid #22c55e;
  border-radius: 5px;
}

/* Interlink Flow */
.flow {
  display: flex;
  align-items: center;
  justify-content: space-around;
  flex-wrap: wrap;
  gap: 10px;
  margin-top: 15px;
}

.flow span {
  display: inline-block;
  background: rgba(30, 41, 59, 0.8);
  padding: 10px 15px;
  border-radius: 8px;
  border: 2px solid #334155;
  transition: all 0.3s;
}

.flow span:hover {
  border-color: #38bdf8;
  transform: scale(1.05);
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .game-grid {
    grid-template-columns: 1fr;
  }
  
  .strategy-grid {
    grid-template-columns: 1fr;
  }
  
  h1 {
    font-size: 1.8em;
  }
  
  .character {
    font-size: 80px;
  }
}

/* Notification Toast */
.toast {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(2, 6, 23, 0.95);
  border: 2px solid #22c55e;
  padding: 15px 25px;
  border-radius: 10px;
  z-index: 1000;
  animation: slideUp 0.5s;
  display: none;
}

.toast.show {
  display: block;
}

@keyframes slideUp {
  from { transform: translateY(100px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
</style>
</head>

<body>

<!-- Animated Background Particles -->
<div class="bg-particles" id="particles"></div>

<!-- Sound Toggle -->
<div class="sound-toggle" id="soundToggle" onclick="toggleSound()">üîä</div>

<!-- Toast Notifications -->
<div class="toast" id="toast"></div>

<div class="container">

<!-- Header -->
<div class="game-header">
  <h1>üéÆ Velocity Banking Simulator Pro</h1>
  <p class="subtitle">Master Financial Strategy Through Interactive Gaming</p>
  
  <!-- Animated Character -->
  <div class="character-container">
    <div class="character" id="character" onclick="characterSpeak()">üßô‚Äç‚ôÇÔ∏è</div>
    <div class="character-speech" id="speech">
      <strong>Financial Mentor:</strong> "Welcome! I'll guide you to financial mastery. Click me anytime for tips!"
    </div>
  </div>
</div>

<!-- Level & Progress System -->
<div class="progress-bar">
  <div class="level-display">
    <div>
      <span style="color: #94a3b8;">Current Level:</span>
      <span class="level-badge" id="levelBadge">Level 1 - Beginner</span>
    </div>
    <div style="color: #94a3b8;">
      <strong>XP: <span id="xpCount">0</span> / <span id="xpNext">100</span></strong>
    </div>
  </div>
  <div class="xp-bar">
    <div class="xp-fill" id="xpBar" style="width: 0%">0%</div>
  </div>
  
  <div class="badges-earned" id="badgesContainer">
    <span style="color: #94a3b8;">üèÜ Earn badges by completing challenges!</span>
  </div>
</div>

<!-- Main Game Grid -->
<div class="game-grid">

  <!-- Player Profile -->
  <div class="panel">
    <h2>üíæ Player Profile</h2>
    <label>Player Name</label>
    <input id="name" placeholder="Enter your name">
    
    <label>Game Mode</label>
    <select id="mode" onchange="changeMode()">
      <option value="normal">Normal Mode</option>
      <option value="sandbox">Sandbox (No Limits)</option>
      <option value="classroom">Classroom Edition</option>
      <option value="challenge">Challenge Mode</option>
    </select>
    
    <button onclick="saveProfile()">üíæ Save Progress</button>
    <button class="secondary" onclick="loadProfile()">üìÇ Load Profile</button>
  </div>

  <!-- Financial Accounts -->
  <div class="panel">
    <h2>üí≥ Your Accounts</h2>
    
    <label>Monthly Income ($)</label>
    <input type="number" id="income" value="5000">
    
    <label>Monthly Expenses ($)</label>
    <input type="number" id="expenses" value="3000">
    
    <label>Credit Card Balance ($)</label>
    <input type="number" id="cc" value="10000">
    
    <label>PLOC Balance ($)</label>
    <input type="number" id="ploc" value="0">
    
    <button onclick="runMonth()">‚ñ∂Ô∏è Run Month Simulation</button>
    <button class="secondary" onclick="reset()">üîÑ Reset</button>
  </div>

  <!-- Results & Analytics -->
  <div class="panel">
    <h2>üìä Financial Results</h2>
    <div class="results" id="resultsPanel">
      <p style="text-align: center; color: #94a3b8;">Run a simulation to see results</p>
    </div>
    
    <div style="margin-top: 20px;">
      <h3 style="color: #38bdf8; margin-bottom: 10px;">Credit Score</h3>
      <div class="xp-bar">
        <div class="xp-fill" id="creditBar" style="width: 65%; background: linear-gradient(90deg, #ef4444, #22c55e);">
          <span id="creditScore">650</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Strategy Comparison -->
  <div class="panel">
    <h2>üìà Strategy Comparison</h2>
    <div class="strategy-grid">
      <div class="strategy-card" onclick="selectStrategy('traditional')">
        <div style="font-size: 2em;">üê¢</div>
        <strong>Traditional</strong>
        <p style="font-size: 0.9em; margin-top: 5px;">Minimum payments</p>
      </div>
      
      <div class="strategy-card active" onclick="selectStrategy('velocity')">
        <div style="font-size: 2em;">‚ö°</div>
        <strong>Velocity</strong>
        <p style="font-size: 0.9em; margin-top: 5px;">Income flow method</p>
      </div>
      
      <div class="strategy-card" onclick="selectStrategy('ploc')">
        <div style="font-size: 2em;">üíé</div>
        <strong>PLOC Hybrid</strong>
        <p style="font-size: 0.9em; margin-top: 5px;">Advanced control</p>
      </div>
    </div>
    
    <div class="results" style="margin-top: 15px;" id="strategyResults">
      <p><strong>Selected:</strong> <span class="good">Velocity Banking</span></p>
      <p>‚úÖ Faster debt payoff</p>
      <p>‚úÖ Lower interest payments</p>
      <p>‚úÖ Improved cash flow control</p>
    </div>
  </div>

</div>

<!-- AI Mentor Chat -->
<div class="panel">
  <h2>üß† AI Financial Mentor</h2>
  <div class="chat" id="chat">
    <p>üß† Hello! I'm your AI mentor. Ask me about velocity banking, PLOC strategies, credit improvement, or any financial concept!</p>
  </div>
  <input id="question" placeholder="Ask the mentor anything..." onkeypress="if(event.key==='Enter') mentor()">
  <button onclick="mentor()">üí¨ Ask Mentor</button>
  <button class="secondary" onclick="getMentorTip()">üí° Get Random Tip</button>
</div>

<!-- Multiplayer Classroom Dashboard -->
<div class="panel">
  <h2>üë• Classroom Leaderboard</h2>
  <p style="color: #94a3b8; margin-bottom: 15px;">Compete with other players in real-time!</p>
  
  <div class="leaderboard" id="leaderboard">
    <!-- Populated dynamically -->
  </div>
  
  <button class="secondary" onclick="joinClassroom()">üéì Join Classroom Session</button>
</div>

<!-- Interlink Method Flow -->
<div class="panel">
  <h2>üåê Interlink Method‚Ñ¢ Demo</h2>
  <p style="color: #94a3b8; margin-bottom: 10px;">See how users flow through the system:</p>
  <div class="flow">
    <span>üì± Social</span> ‚ûú
    <span>üéÆ Game Demo</span> ‚ûú
    <span>üìö Learn</span> ‚ûú
    <span>üí≥ Checkout</span> ‚ûú
    <span>üéì Classroom</span>
  </div>
</div>

<!-- Stripe Checkout Demo -->
<div class="panel checkout-panel">
  <h2>üöÄ Upgrade to Pro Version</h2>
  <div class="price-tag">$47</div>
  
  <div class="features-list">
    <div class="feature-item">‚úÖ Unlimited scenarios & simulations</div>
    <div class="feature-item">‚úÖ Advanced AI mentor with GPT-4</div>
    <div class="feature-item">‚úÖ Multiplayer classroom mode</div>
    <div class="feature-item">‚úÖ Progress tracking & certificates</div>
    <div class="feature-item">‚úÖ Mobile app access</div>
    <div class="feature-item">‚úÖ Live coaching sessions</div>
  </div>
  
  <button onclick="openCheckout()">üí≥ Checkout with Stripe</button>
  <p style="text-align: center; font-size: 0.9em; margin-top: 10px; color: #94a3b8;">
    Demo mode - No actual payment processed
  </p>
</div>

</div>

<script>
// ========== GLOBAL STATE ==========
let playerData = {
  name: '',
  xp: 0,
  level: 1,
  badges: [],
  creditScore: 650,
  currentStrategy: 'velocity',
  soundEnabled: true
};

let monthsSimulated = 0;
let currentMode = 'normal';

// ========== INITIALIZATION ==========
function init() {
  createParticles();
  loadProfile();
  updateLeaderboard();
  playSound('welcome');
}

// ========== ANIMATED PARTICLES ==========
function createParticles() {
  const container = document.getElementById('particles');
  for (let i = 0; i < 50; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    particle.style.left = Math.random() * 100 + '%';
    particle.style.animationDelay = Math.random() * 15 + 's';
    particle.style.animationDuration = (10 + Math.random() * 10) + 's';
    container.appendChild(particle);
  }
}

// ========== SOUND SYSTEM ==========
function playSound(type) {
  if (!playerData.soundEnabled) return;
  
  // Simulated sound effects using Web Audio API
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const oscillator = audioCtx.createOscillator();
  const gainNode = audioCtx.createGain();
  
  oscillator.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  
  const sounds = {
    'click': { freq: 400, duration: 0.1 },
    'success': { freq: 600, duration: 0.2 },
    'level': { freq: 800, duration: 0.3 },
    'badge': { freq: 1000, duration: 0.2 },
    'welcome': { freq: 500, duration: 0.15 }
  };
  
  const sound = sounds[type] || sounds.click;
  oscillator.frequency.value = sound.freq;
  gainNode.gain.value = 0.1;
  
  oscillator.start();
  oscillator.stop(audioCtx.currentTime + sound.duration);
}

function toggleSound() {
  playerData.soundEnabled = !playerData.soundEnabled;
  document.getElementById('soundToggle').textContent = playerData.soundEnabled ? 'üîä' : 'üîá';
  playSound('click');
  showToast(playerData.soundEnabled ? 'Sound ON' : 'Sound OFF');
}

// ========== CHARACTER INTERACTION ==========
function characterSpeak() {
  const speech = document.getElementById('speech');
  speech.classList.toggle('show');
  playSound('click');
  
  const tips = [
    "Remember: Cash flow is king! Control where your money goes.",
    "Velocity banking uses your income flow to pay down debt faster.",
    "PLOC gives you flexibility - it's like a financial Swiss Army knife!",
    "Low credit utilization = higher credit score. Keep it under 30%!",
    "Think of debt payoff as a game - every month you win or lose points!",
    "The faster money moves through debt, the less interest you pay."
  ];
  
  const randomTip = tips[Math.floor(Math.random() * tips.length)];
  speech.innerHTML = `<strong>Financial Mentor:</strong> "${randomTip}"`;
}

// ========== GAME SIMULATION ==========
function runMonth() {
  monthsSimulated++;
  
  const income = Number(document.getElementById('income').value) || 0;
  const expenses = Number(document.getElementById('expenses').value) || 0;
  const cc = Number(document.getElementById('cc').value) || 0;
  const ploc = Number(document.getElementById('ploc').value) || 0;
  
  const surplus = income - expenses;
  let newCC = cc;
  let newPLOC = ploc;
  let creditChange = 0;
  
  // Apply selected strategy
  if (playerData.currentStrategy === 'velocity') {
    if (surplus > 0) {
      newCC = Math.max(0, cc - surplus);
      creditChange = 5;
      addXP(20);
    } else {
      creditChange = -10;
    }
  } else if (playerData.currentStrategy === 'ploc') {
    if (surplus > 0) {
      newPLOC = ploc + surplus;
      newCC = Math.max(0, cc - (surplus * 0.8));
      creditChange = 7;
      addXP(30);
    }
  } else {
    // Traditional - minimum payment
    newCC = Math.max(0, cc - (cc * 0.02));
    creditChange = 2;
    addXP(10);
  }
  
  // Update credit score
  playerData.creditScore = Math.min(850, Math.max(300, playerData.creditScore + creditChange));
  
  // Update UI
  document.getElementById('cc').value = Math.round(newCC);
  document.getElementById('ploc').value = Math.round(newPLOC);
  
  updateCreditScore();
  displayResults(income, expenses, newCC, newPLOC, surplus);
  
  // Check for achievements
  checkAchievements(newCC, surplus);
  
  playSound('success');
  showToast(`Month ${monthsSimulated} Complete!`);
}

function displayResults(income, expenses, cc, ploc, surplus) {
  const panel = document.getElementById('resultsPanel');
  const surplusClass = surplus > 0 ? 'good' : surplus < 0 ? 'bad' : 'warn';
  
  panel.innerHTML = `
    <div class="stat-row">
      <span>Month Simulated:</span>
      <strong>#${monthsSimulated}</strong>
    </div>
    <div class="stat-row">
      <span>Monthly Surplus:</span>
      <strong class="${surplusClass}">$${surplus.toFixed(2)}</strong>
    </div>
    <div class="stat-row">
      <span>CC Balance:</span>
      <strong class="${cc > 0 ? 'warn' : 'good'}">$${cc.toFixed(2)}</strong>
    </div>
    <div class="stat-row">
      <span>PLOC Balance:</span>
      <strong class="good">$${ploc.toFixed(2)}</strong>
    </div>
    <div class="stat-row">
      <span>Debt Payoff Progress:</span>
      <strong>${cc === 0 ? '‚úÖ Debt Free!' : Math.round((1 - cc/10000) * 100) + '%'}</strong>
    </div>
  `;
}

function updateCreditScore() {
  const score = playerData.creditScore;
  const percentage = ((score - 300) / (850 - 300)) * 100;
  const bar = document.getElementById('creditBar');
  const display = document.getElementById('creditScore');
  
  bar.style.width = percentage + '%';
  display.textContent = score;
  
  let rating = score > 720 ? "Excellent" :
               score > 680 ? "Good" :
               score > 620 ? "Fair" : "Poor";
  
  display.textContent = `${score} - ${rating}`;
}

// ========== XP & LEVELING SYSTEM ==========
function addXP(amount) {
  playerData.xp += amount;
  
  const xpNeeded = playerData.level * 100;
  
  // Update display
  document.getElementById('xpCount').textContent = playerData.xp;
  document.getElementById('xpNext').textContent = xpNeeded;
  
  const percentage = (playerData.xp / xpNeeded) * 100;
  const bar = document.getElementById('xpBar');
  bar.style.width = Math.min(100, percentage) + '%';
  bar.textContent = Math.round(percentage) + '%';
  
  // Level up check
  if (playerData.xp >= xpNeeded) {
    levelUp();
  }
}

function levelUp() {
  playerData.level++;
  playerData.xp = 0;
  
  const levels = {
    1: 'Beginner',
    2: 'Apprentice',
    3: 'Journeyman',
    4: 'Expert',
    5: 'Master',
    6: 'Grandmaster',
    7: 'Legend'
  };
  
  const levelName = levels[Math.min(playerData.level, 7)] || 'Financial Guru';
  document.getElementById('levelBadge').textContent = `Level ${playerData.level} - ${levelName}`;
  
  playSound('level');
  showToast(`üéâ Level Up! You are now ${levelName}!`);
  
  // Reset XP bar
  addXP(0);
}

// ========== BADGE SYSTEM ==========
function checkAchievements(cc, surplus) {
  const badges = {
    'first_month': { name: 'üéÆ First Month', condition: monthsSimulated === 1 },
    'positive_flow': { name: 'üí∞ Positive Flow', condition: surplus > 0 },
    'debt_free': { name: 'üéä Debt Free!', condition: cc === 0 },
    'credit_boost': { name: 'üìà Credit Booster', condition: playerData.creditScore > 700 },
    'velocity_pro': { name: '‚ö° Velocity Pro', condition: monthsSimulated >= 10 },
    'strategist': { name: 'üß† Master Strategist', condition: playerData.xp > 500 }
  };
  
  for (const [key, badge] of Object.entries(badges)) {
    if (badge.condition && !playerData.badges.includes(key)) {
      earnBadge(key, badge.name);
    }
  }
}

function earnBadge(id, name) {
  playerData.badges.push(id);
  
  const container = document.getElementById('badgesContainer');
  const badge = document.createElement('div');
  badge.className = 'badge';
  badge.textContent = name;
  container.appendChild(badge);
  
  playSound('badge');
  showToast(`üèÜ Badge Earned: ${name}`);
  addXP(50);
}

// ========== STRATEGY SELECTION ==========
function selectStrategy(strategy) {
  playerData.currentStrategy = strategy;
  
  document.querySelectorAll('.strategy-card').forEach(card => {
    card.classList.remove('active');
  });
  event.target.closest('.strategy-card').classList.add('active');
  
  const results = {
    'traditional': {
      title: 'Traditional Debt Payoff',
      points: ['‚è±Ô∏è Slower payoff timeline', 'üí∏ Higher interest costs', 'üòê Standard approach']
    },
    'velocity': {
      title: 'Velocity Banking',
      points: ['‚ö° Faster debt elimination', 'üí∞ Lower interest paid', 'üìà Improved cash control']
    },
    'ploc': {
      title: 'PLOC Hybrid Strategy',
      points: ['üíé Maximum flexibility', 'üéØ Advanced optimization', 'üöÄ Professional level']
    }
  };
  
  const info = results[strategy];
  const panel = document.getElementById('strategyResults');
  panel.innerHTML = `
    <p><strong>Selected:</strong> <span class="good">${info.title}</span></p>
    ${info.points.map(p => `<p>${p}</p>`).join('')}
  `;
  
  playSound('click');
}

// ========== AI MENTOR ==========
function mentor() {
  const q = document.getElementById('question').value.toLowerCase();
  const chat = document.getElementById('chat');
  
  let reply = "That's a great question! Let me explain...";
  
  // Simple AI responses (in production, this would use real AI API)
  if (q.includes('velocity')) {
    reply = "‚ö° Velocity banking accelerates debt payoff by using your income flow strategically. Instead of letting money sit idle, you channel it directly into debt reduction, then pull it back when needed. This reduces interest charges significantly!";
  } else if (q.includes('ploc')) {
    reply = "üíé A Personal Line of Credit (PLOC) is like having a financial Swiss Army knife. It gives you flexibility to move money efficiently while maintaining liquidity. Think of it as your emergency fund that also works to reduce debt!";
  } else if (q.includes('credit')) {
    reply = "üìà Your credit score improves when you keep utilization low (under 30%), make on-time payments, and reduce overall debt. Velocity banking helps by paying down balances faster!";
  } else if (q.includes('how') || q.includes('start')) {
    reply = "üéØ Start by understanding your cash flow: Income - Expenses = Surplus. Use that surplus strategically. The velocity method channels it into debt payoff, saving you thousands in interest!";
  } else if (q.includes('interest')) {
    reply = "üí∞ Interest is the cost of borrowing money. The faster you pay down principal, the less interest accumulates. Velocity banking minimizes this by keeping money moving through your debt!";
  } else {
    reply = "üß† " + [
      "Focus on cash flow control - it's the foundation of wealth!",
      "Every dollar has a job. Make yours work efficiently!",
      "Think long-term. Small optimizations compound over time.",
      "Financial freedom comes from controlling where money flows."
    ][Math.floor(Math.random() * 4)];
  }
  
  chat.innerHTML += `<p>üß† <strong>Mentor:</strong> ${reply}</p>`;
  chat.scrollTop = chat.scrollHeight;
  
  document.getElementById('question').value = '';
  playSound('click');
  addXP(5);
}

function getMentorTip() {
  const tips = [
    "üí° Pro Tip: Run simulations with different income levels to see how raises impact your timeline!",
    "üí° Did you know? Every $100 extra toward debt can save you hundreds in interest!",
    "üí° Quick Win: Cut one subscription and redirect that money to debt. Small changes add up!",
    "üí° Strategy: Pay off high-interest debt first for maximum impact.",
    "üí° Remember: Financial freedom isn't about earning more, it's about controlling flow better!",
    "üí° Challenge: Try the PLOC strategy - it's advanced but powerful for those ready to optimize!"
  ];
  
  const tip = tips[Math.floor(Math.random() * tips.length)];
  document.getElementById('chat').innerHTML += `<p>${tip}</p>`;
  document.getElementById('chat').scrollTop = 9999;
  playSound('click');
}

// ========== MULTIPLAYER/CLASSROOM ==========
function updateLeaderboard() {
  const leaderboard = document.getElementById('leaderboard');
  
  // Simulated leaderboard data
  const players = [
    { name: 'Alex M.', score: 2450, level: 5 },
    { name: 'Sarah K.', score: 2180, level: 4 },
    { name: playerData.name || 'You', score: playerData.xp, level: playerData.level },
    { name: 'Mike R.', score: 1890, level: 4 },
    { name: 'Emma L.', score: 1650, level: 3 },
    { name: 'Chris P.', score: 1420, level: 3 }
  ].sort((a, b) => b.score - a.score);
  
  leaderboard.innerHTML = '';
  players.slice(0, 6).forEach((player, index) => {
    const entry = document.createElement('div');
    entry.className = 'player-entry';
    const isPlayer = player.name === playerData.name || player.name === 'You';
    if (isPlayer) entry.style.borderColor = '#22c55e';
    
    entry.innerHTML = `
      <span class="player-rank">#${index + 1}</span>
      <div style="flex: 1;">
        <strong>${player.name}${isPlayer ? ' (You)' : ''}</strong>
        <div style="font-size: 0.85em; opacity: 0.7;">Level ${player.level}</div>
      </div>
      <div style="text-align: right;">
        <strong style="color: #38bdf8;">${player.score} XP</strong>
      </div>
    `;
    leaderboard.appendChild(entry);
  });
}

function joinClassroom() {
  playSound('success');
  showToast('üéì Joined Classroom Mode! Compete with other students in real-time.');
  updateLeaderboard();
  
  // Simulate real-time updates
  setInterval(() => {
    if (Math.random() > 0.7) updateLeaderboard();
  }, 10000);
}

// ========== PROFILE MANAGEMENT ==========
function saveProfile() {
  playerData.name = document.getElementById('name').value;
  localStorage.setItem('velocityProfile', JSON.stringify(playerData));
  playSound('success');
  showToast('‚úÖ Progress Saved!');
}

function loadProfile() {
  const saved = localStorage.getItem('velocityProfile');
  if (saved) {
    playerData = JSON.parse(saved);
    document.getElementById('name').value = playerData.name;
    document.getElementById('creditScore').textContent = playerData.creditScore;
    
    // Restore badges
    playerData.badges.forEach(id => {
      const badgeNames = {
        'first_month': 'üéÆ First Month',
        'positive_flow': 'üí∞ Positive Flow',
        'debt_free': 'üéä Debt Free!',
        'credit_boost': 'üìà Credit Booster',
        'velocity_pro': '‚ö° Velocity Pro',
        'strategist': 'üß† Master Strategist'
      };
      if (badgeNames[id]) {
        const badge = document.createElement('div');
        badge.className = 'badge';
        badge.textContent = badgeNames[id];
        document.getElementById('badgesContainer').appendChild(badge);
      }
    });
    
    addXP(0); // Update displays
    updateCreditScore();
    updateLeaderboard();
    
    showToast('üìÇ Profile Loaded!');
  }
}

function reset() {
  if (confirm('Reset all progress? This cannot be undone.')) {
    document.getElementById('income').value = 5000;
    document.getElementById('expenses').value = 3000;
    document.getElementById('cc').value = 10000;
    document.getElementById('ploc').value = 0;
    monthsSimulated = 0;
    document.getElementById('resultsPanel').innerHTML = '<p style="text-align: center; color: #94a3b8;">Run a simulation to see results</p>';
    playSound('click');
    showToast('üîÑ Reset Complete');
  }
}

function changeMode() {
  currentMode = document.getElementById('mode').value;
  const messages = {
    'normal': 'Standard game mode activated',
    'sandbox': 'üéÆ Sandbox Mode: Experiment freely!',
    'classroom': 'üéì Classroom Mode: Perfect for group learning!',
    'challenge': 'üèÜ Challenge Mode: Hard difficulty activated!'
  };
  showToast(messages[currentMode]);
  playSound('click');
}

// ========== STRIPE CHECKOUT DEMO ==========
function openCheckout() {
  playSound('click');
  
  // In production, this would open real Stripe Checkout
  const demoMessage = `
    üöÄ DEMO MODE
    
    In production, this would open Stripe Checkout for:
    
    üí≥ Velocity Banking Pro - $47
    
    Features:
    ‚úÖ Unlimited simulations
    ‚úÖ Advanced AI mentor (GPT-4)
    ‚úÖ Multiplayer classroom mode
    ‚úÖ Progress tracking & certificates
    ‚úÖ Mobile app access
    ‚úÖ Live coaching sessions
    
    Ready to upgrade?
  `;
  
  if (confirm(demoMessage)) {
    showToast('üí≥ Redirecting to Stripe Checkout... (Demo)');
    
    // Simulated Stripe integration
    setTimeout(() => {
      showToast('‚úÖ Payment Successful! (Simulated)');
      earnBadge('pro_member', 'üëë Pro Member');
    }, 2000);
  }
}

// ========== TOAST NOTIFICATIONS ==========
function showToast(message) {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.classList.add('show');
  
  setTimeout(() => {
    toast.classList.remove('show');
  }, 3000);
}

// ========== INITIALIZATION ==========
window.onload = init;

// ========== PRODUCTION EXPANSION NOTES ==========
/*
TO UPGRADE TO FULL PRODUCTION VERSION:

1. REAL AI MENTOR
   - Integrate OpenAI API or Anthropic Claude API
   - Replace mentor() function with API calls
   - Add conversation memory and context

2. REAL-TIME MULTIPLAYER
   - Add WebSocket server (Socket.io or Firebase)
   - Sync player actions across sessions
   - Real leaderboard updates

3. STRIPE INTEGRATION
   - Replace openCheckout() with Stripe.js
   - Add webhook handlers for payment events
   - Create customer portal for subscriptions

4. MOBILE APP
   - Convert to React Native or Flutter
   - Add offline mode with sync
   - Push notifications for achievements

5. BACKEND DATABASE
   - Replace localStorage with PostgreSQL/MongoDB
   - User authentication (Auth0, Firebase Auth)
   - API endpoints for all game actions

6. ADVANCED ANALYTICS
   - Track user behavior and learning patterns
   - Generate personalized recommendations
   - A/B test different teaching methods

7. CURRICULUM INTEGRATION
   - Create lesson plans for teachers
   - Add quiz system with grading
   - Generate progress reports for students

8. REVENUE STREAMS
   - Subscription model ($47/month or $497/year)
   - School/enterprise licensing
   - Affiliate program for financial educators
   - White-label option for banks/credit unions

9. MICROLEARNING FEATURES
   - Daily financial challenges
   - Video tutorials
   - Interactive case studies
   - Certification system

10. SOCIAL FEATURES
    - Share achievements on social media
    - Challenge friends to compete
    - Community forums
    - Expert Q&A sessions
*/
</script>

</body>
</html>
